TODOs

Move logic from controllers to models